{
  "name": "oidc",
  "desc": "OAuth 2.1 / OpenID Connect Provider for traP SSO.\ntraP の各サービス (traQ, knoQ, NeoShowcase 等) への SSO 基盤を提供する。\n",
  "tables": [
    {
      "name": "clients",
      "type": "BASE TABLE",
      "comment": "OAuth 2.1 / OIDC クライアントテーブル。\n各サービスは Client Credentials または Authorization Code フローでトークンを取得し、\nユーザーの所属グループ情報等を取得できる。\n",
      "columns": [
        {
          "name": "client_id",
          "type": "char(36)",
          "nullable": false,
          "comment": "クライアントUUID (RFC 7591準拠)"
        },
        {
          "name": "client_secret_hash",
          "type": "varchar(255)",
          "nullable": true,
          "default": "NULL",
          "comment": "ハッシュ化されたクライアントシークレット (confidential client用、public clientはNULL)"
        },
        {
          "name": "name",
          "type": "varchar(255)",
          "nullable": false,
          "comment": "クライアント名 (traQ, knoQ, NeoShowcase等)"
        },
        {
          "name": "client_type",
          "type": "varchar(20)",
          "nullable": false,
          "comment": "クライアントタイプ:\n- public: SPA等のシークレットを安全に保持できないクライアント\n- confidential: サーバーサイドでシークレットを保持できるクライアント\n"
        },
        {
          "name": "redirect_uris",
          "type": "longtext",
          "nullable": false,
          "comment": "OAuth認可後のリダイレクトURI (JSON配列、複数環境対応)"
        },
        {
          "name": "created_at",
          "type": "datetime(6)",
          "nullable": false,
          "default": "current_timestamp(6)",
          "comment": "作成日時"
        },
        {
          "name": "updated_at",
          "type": "datetime(6)",
          "nullable": false,
          "default": "current_timestamp(6)",
          "extra_def": "on update current_timestamp(6)",
          "comment": "更新日時"
        }
      ],
      "indexes": [
        {
          "name": "PRIMARY",
          "def": "PRIMARY KEY (client_id) USING BTREE",
          "table": "clients",
          "columns": [
            "client_id"
          ],
          "comment": "主キー"
        }
      ],
      "constraints": [
        {
          "name": "PRIMARY",
          "type": "PRIMARY KEY",
          "def": "PRIMARY KEY (client_id)",
          "table": "clients",
          "columns": [
            "client_id"
          ],
          "comment": "主キー"
        },
        {
          "name": "redirect_uris",
          "type": "CHECK",
          "def": "CHECK (json_valid(`redirect_uris`))",
          "table": "clients",
          "comment": "JSONバリデーション"
        }
      ],
      "def": "CREATE TABLE `clients` (\n  `client_id` char(36) NOT NULL,\n  `client_secret_hash` varchar(255) DEFAULT NULL,\n  `name` varchar(255) NOT NULL,\n  `client_type` varchar(20) NOT NULL,\n  `redirect_uris` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL CHECK (json_valid(`redirect_uris`)),\n  `created_at` datetime(6) NOT NULL DEFAULT current_timestamp(6),\n  `updated_at` datetime(6) NOT NULL DEFAULT current_timestamp(6) ON UPDATE current_timestamp(6),\n  PRIMARY KEY (`client_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci",
      "labels": [
        {
          "name": "OAuth2/OIDC",
          "virtual": true
        }
      ]
    }
  ],
  "driver": {
    "name": "mariadb",
    "database_version": "12.1.2-MariaDB-ubu2404",
    "meta": {
      "dict": {
        "Functions": "Stored procedures and functions"
      }
    }
  }
}
