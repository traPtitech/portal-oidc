openapi: 3.0.0
info:
  title: Portal OIDC
  version: "3.0"
  description: 認可認証基盤
  license:
    name: MIT
    url: "https://github.com/traPtitech/portal-oidc/blob/master/LICENSE"
  contact:
    name: traP
    url: "https://github.com/traPtitech/portal-oidc"
servers:
  - url: "http://localhost:8080"
    description: local

tags:
  - name: client
    description: クライアント管理

paths:
  "/v1/clients":
    post:
      summary: クライアントを作成
      description: クライアントを作成します
      operationId: CreateClient
      tags:
        - client
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateClientRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
        "400":
          description: Bad Request
        "401":
          description: Unauthorized

    get:
      summary: クライアント一覧を取得
      description: クライアントの一覧を取得します
      operationId: ListClients
      tags:
        - client
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Client"
        "401":
          description: Unauthorized

  "/v1/clients/{clientId}":
    put:
      summary: クライアントを更新
      description: クライアントを更新します
      operationId: UpdateClient
      tags:
        - client
      parameters:
        - name: clientId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateClientRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Client"
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "404":
          description: Not Found

    delete:
      summary: クライアントを削除
      description: クライアントを削除します
      operationId: DeleteClient
      tags:
        - client
      parameters:
        - name: clientId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found

  "/v1/clients/{clientId}/secret":
    put:
      summary: クライアントシークレットを更新
      description: クライアントのシークレットを再生成します
      operationId: UpdateClientSecret
      tags:
        - client
      parameters:
        - name: clientId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateClientSecretResponse"
        "401":
          description: Unauthorized
        "404":
          description: Not Found

components:
  schemas:
    Client:
      type: object
      required:
        - id
        - name
        - type
        - redirect_uris
      properties:
        id:
          type: string
          format: uuid
          description: クライアントID
        name:
          type: string
          description: クライアント名
        type:
          type: string
          enum: [public, confidential]
          description: クライアントタイプ
        secret:
          type: string
          description: クライアントシークレット (作成時のみ返却、confidentialの場合)
        description:
          type: string
          description: 説明
        redirect_uris:
          type: array
          items:
            type: string
          description: 許可するリダイレクトURI

    CreateClientRequest:
      type: object
      required:
        - name
        - type
        - redirect_uris
      properties:
        name:
          type: string
          description: クライアント名
        type:
          type: string
          enum: [public, confidential]
          description: クライアントタイプ
        description:
          type: string
          description: 説明
        redirect_uris:
          type: array
          items:
            type: string
          description: 許可するリダイレクトURI

    UpdateClientRequest:
      type: object
      required:
        - name
        - type
        - redirect_uris
      properties:
        name:
          type: string
          description: クライアント名
        type:
          type: string
          enum: [public, confidential]
          description: クライアントタイプ
        description:
          type: string
          description: 説明
        redirect_uris:
          type: array
          items:
            type: string
          description: 許可するリダイレクトURI

    UpdateClientSecretResponse:
      type: object
      required:
        - client_secret
      properties:
        client_secret:
          type: string
          description: 新しいクライアントシークレット
