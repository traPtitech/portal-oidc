[tools]
go = "1.25.5"
"golangci-lint" = "latest"
"atlas" = "latest"
"aqua:k1LoW/tbls" = "latest"

[tasks."start:server"]
description = "OIDCサーバーを起動"
run = "go run ./cmd serve"

[tasks."migrate:diff"]
description = "スキーマ差分からマイグレーションを生成"
dir = "db"
run = "atlas migrate diff --env local"

[tasks."migrate:apply"]
description = "マイグレーションを適用"
dir = "db"
run = "atlas migrate apply --env local"

[tasks."migrate:status"]
description = "マイグレーション状態を表示"
dir = "db"
run = "atlas migrate status --env local"

[tasks."schema:inspect"]
description = "データベーススキーマを確認"
dir = "db"
run = "atlas schema inspect --env local"

[tasks.sqlc]
description = "sqlcコードを生成"
run = "go tool sqlc generate --file ./db/sqlc.yaml"

[tasks.gen]
description = "コードを生成"
run = "go generate ./..."

[tasks."lint:go"]
description = "Goリンターを実行"
run = "golangci-lint run"

[tasks."lint:schema"]
description = "スキーマリンターを実行"
run = "tbls lint -c db/tbls.yml"

[tasks.lint]
description = "全リンターを実行"
depends = ["lint:go", "lint:schema"]

[tasks."docs:oidc"]
description = "OIDCデータベースのドキュメントを生成"
run = "tbls doc -c db/tbls.yml --force"

[tasks."docs:portal"]
description = "Portalデータベースのドキュメントを生成"
run = "tbls doc postgres://postgres:password@localhost:5432/portal?sslmode=disable docs/schema/portal --force"

[tasks.docs]
description = "全データベースのドキュメントを生成"
depends = ["docs:oidc", "docs:portal"]
